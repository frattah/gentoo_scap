# platform = multi_platform_all
# reboot = false
# strategy = disable
# complexity = low
# disruption = low

# Currently, Ansible can only collect systemd facts about service units. Socket units are needed.
- name: "Disable acquiring, saving, and processing core dumps - Collect systemd Socket Units Present in the System"
  ansible.builtin.command:
    cmd: systemctl -q list-unit-files --type socket
  register: result_systemd_unit_files
  changed_when: false

- name: "Disable acquiring, saving, and processing core dumps - Ensure systemd-coredump.socket is Masked"
  ansible.builtin.systemd:
    name: systemd-coredump.socket
    state: stopped
    enabled: false
    masked: true
  when:
    - result_systemd_unit_files.stdout_lines is search("systemd-coredump.socket")